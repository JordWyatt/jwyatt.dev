{"componentChunkName":"component---src-templates-blog-post-js","path":"/rightmove-scraper/","result":{"data":{"site":{"siteMetadata":{"title":"jwyatt.dev"}},"markdownRemark":{"id":"ed246209-4969-5282-a053-d7c91dabdf7a","excerpt":"Source Code The Problem Finding property is monotonous, there is no question about it. RightMove is, as far as I’m aware, the most popular property search site…","html":"<p><a href=\"https://github.com/JordWyatt/rightmove-by-notice-period\">Source Code</a></p>\n<h3>The Problem</h3>\n<hr>\n<p>Finding property is monotonous, there is no question about it.</p>\n<p><a href=\"https://rightmove.co.uk\">RightMove</a> is, as far as I’m aware, the most popular property search site in the U.K. I’d been spending a lot of time on the site trying to search for a new rental whilst working around my agreed 8 week notice period.</p>\n<p>This process involved (for each potential location):</p>\n<ol>\n<li>Performing a search</li>\n<li>Setting up a daily email alert for new properties</li>\n<li>\n<p>For each property in the daily alert email</p>\n<ol>\n<li>Check if the listing has its date of availability listed</li>\n<li>Ensure this date is at least 8 weeks away from the current date</li>\n</ol>\n</li>\n</ol>\n<p>Most of the time the properties were available sooner than needed which was not only a waste of time, but created cycles of excitement and disappointment.</p>\n<p>I couldn’t be bothered anymore. The lack of ability to filter on ‘Date Available’ was driving me mad, so I decided to automate the process.</p>\n<h3>Finding Candidate Properties</h3>\n<hr>\n<p>To scrape RightMove I used Python in conjunction with <a href=\"https://www.crummy.com/software/BeautifulSoup/bs4/doc/\">BeautifulSoup</a>. To anyone who is familiar with either of these technologies the contents of this post will probably bore you, however, as someone who had only used Python for a brief period during my degree this felt like the perfect learning opportunity.</p>\n<p>For those unfamiliar, BeautifulSoup is a Python package for parsing HTML. It creates a parse tree for parsed pages which allows developers to easily extract information from HTML by traversing the tree.</p>\n<p>The first step was to add the ability to configure and perform searches to provide the results page containing listings for scraping.</p>\n<p>Let’s disect a manual search to see the necessary components:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/93d68a4635e2043f389dfc6c301bf525/d9ed5/search.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABXklEQVQoz61QTU/CQBDtf/W/eJGDIcFQhPAlgbaE70g0IRDQ6AUSNcaDiDYVykdbChWRbtvn7iZw8ugkL/tmdufNmxWenl+gTXTo+hRjek6nM3Q6t5AKZUjFGmSliny+hALNGWS5wnNJqlBehaLUsFgYWK3W6PXuIcznBoyFCdO0YBgWNG2MSqUJUcwgkcghlSpwLkbTiNM8Hr9AVEwjFssgmcwjSe9te4XtdotmswXBdV0wBEGA/whhubS53fXawWbzjW73DtmsgnL5ErlcEY3GNdrtG1qTOVfoN9TrV7xWKjW4K7ZRq9UDIQQCs6vrM7quyUWHw3cMBo/o9x84WM4ajo9PEYkkEAqdIRw+h6p+YjRSoX1oUN9UTLQJ35I7ZGKWtYTjfPH1Pc/DbueC0PPA6XTGCfH4m30Qig3FDwUXZCL7YAXf9w9gzUz0r2BDfIqMo+FI7+PEfgUJfPwC7CnzO459aUEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Search\"\n        title=\"Search\"\n        src=\"/static/93d68a4635e2043f389dfc6c301bf525/fcda8/search.png\"\n        srcset=\"/static/93d68a4635e2043f389dfc6c301bf525/12f09/search.png 148w,\n/static/93d68a4635e2043f389dfc6c301bf525/e4a3f/search.png 295w,\n/static/93d68a4635e2043f389dfc6c301bf525/fcda8/search.png 590w,\n/static/93d68a4635e2043f389dfc6c301bf525/efc66/search.png 885w,\n/static/93d68a4635e2043f389dfc6c301bf525/c83ae/search.png 1180w,\n/static/93d68a4635e2043f389dfc6c301bf525/d9ed5/search.png 2880w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The above search generates a request to <a href=\"https://www.rightmove.co.uk/property-to-rent/find.html\">https://www.rightmove.co.uk/property-to-rent/find.html</a> with the following query string parameters</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b908c0ec7e336ab8d6dc52603f680e94/c6ff8/params.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA80lEQVQoz5WSzW7DIBCE8w6VjY0DeGPA4N+kadq+/4tNFyxFbS8th9EeWD7NaPY0zzvW7Y7t+gYfVgxDQLATRjvDDxFErkinppHQ4w4TX6FZjibMmmUYqDzSe4ky0Ex3mPUD5HeQJLzUNapaoBINhGiLdDgMV2i3IrKzvqP8UOrsh0PFwIvdQJoj1g3q5CwtCFkMPyLHG8zyDr08oD2DlUP7a/G/4CMyQ1IpFLgUu+cyksukKs/2Cf0LfDgMNyh2uZgFn5cH3NllqOU5qhFG9iUOu3w2PUfuKfJnkwFJmpVK6tpzGVDxEaeWO6mfUb9LFET+AqpNCnAvqOapAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Parameters\"\n        title=\"Parameters\"\n        src=\"/static/b908c0ec7e336ab8d6dc52603f680e94/fcda8/params.png\"\n        srcset=\"/static/b908c0ec7e336ab8d6dc52603f680e94/12f09/params.png 148w,\n/static/b908c0ec7e336ab8d6dc52603f680e94/e4a3f/params.png 295w,\n/static/b908c0ec7e336ab8d6dc52603f680e94/fcda8/params.png 590w,\n/static/b908c0ec7e336ab8d6dc52603f680e94/efc66/params.png 885w,\n/static/b908c0ec7e336ab8d6dc52603f680e94/c6ff8/params.png 1088w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Most of this is self explanatory and uninteresting, one thing that did stick out is the location identifier. RightMove appear to use their own propriatary region identifiers which would need to be provided in configuration for each location I wanted to search over.</p>\n<p>Once I’d nabbed the appropriate location identifiers and popped them in a configuration file, I was able to write the function to perform a search over these location identifiers to retrieve the search result pages for each location. The result pages were then processed using the <code class=\"language-text\">get_listing_urls</code> function to pull the URL for each property in the result set.</p>\n<p><code class=\"language-text\">config.ini</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[locations]\nidentifiers = REGION^93802,REGION^87521\n\n[filters]\navailableAfterNWeeks = 7\nradius=1\nminPrice = 0\nmaxPrice = 1500\nminBedrooms = 2\nmaxBedrooms = 3\ndontShow=houseShare,retirement,student\nfurnishTypes=unfurnished,partFurnished</code></pre></div>\n<p><code class=\"language-text\">rightmove_scraper.py</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">   <span class=\"token keyword\">def</span> <span class=\"token function\">scrape_listings</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> location_identifiers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      listings <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">for</span> identifier <span class=\"token keyword\">in</span> location_identifiers<span class=\"token punctuation\">:</span>\n         url <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>build_search_url<span class=\"token punctuation\">(</span>identifier<span class=\"token punctuation\">)</span>\n         listings<span class=\"token punctuation\">.</span>extend<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>scrape<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n      listings <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>remove_duplicate_listings<span class=\"token punctuation\">(</span>listings<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> listings\n\n   <span class=\"token keyword\">def</span> <span class=\"token function\">build_search_url</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> location_identifier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      parameters <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token string\">'filters'</span><span class=\"token punctuation\">)</span>\n      parameters<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"locationIdentifier\"</span><span class=\"token punctuation\">,</span> location_identifier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      search_url <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>base_search_url <span class=\"token operator\">+</span> urlencode<span class=\"token punctuation\">(</span>parameters<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> search_url\n\n\n   <span class=\"token keyword\">def</span> <span class=\"token function\">scrape</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      html <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n      listing_dom <span class=\"token operator\">=</span> BeautifulSoup<span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span> <span class=\"token string\">'html.parser'</span><span class=\"token punctuation\">)</span>\n      location <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_location_name<span class=\"token punctuation\">(</span>listing_dom<span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"Scraping properties in </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">}</span></span><span class=\"token string\">...\"</span></span><span class=\"token punctuation\">)</span>\n\n      listing_urls <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_listing_urls<span class=\"token punctuation\">(</span>listing_dom<span class=\"token punctuation\">)</span>\n      listings <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>Listing<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> url <span class=\"token keyword\">in</span> listing_urls<span class=\"token punctuation\">]</span>\n\n      <span class=\"token keyword\">for</span> listing <span class=\"token keyword\">in</span> listings<span class=\"token punctuation\">:</span>\n         listing<span class=\"token punctuation\">.</span>scrape_details<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">return</span> listings</code></pre></div>\n<h3>Scraping Property Information</h3>\n<hr>\n<p>In the above snippet <code class=\"language-text\">listing_urls</code> is a list containing URLs for each property returned from a search over a specific location identifier. The HTML returned from each of these URLs needed to be scraped to extract information relevant to my search.</p>\n<p>Here is an example of a property listing on RightMove:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee870e31dd25071643e4faeffb882d5a/8b69f/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 168.24324324324326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Result\"\n        title=\"Result\"\n        src=\"/static/ee870e31dd25071643e4faeffb882d5a/fcda8/result.png\"\n        srcset=\"/static/ee870e31dd25071643e4faeffb882d5a/12f09/result.png 148w,\n/static/ee870e31dd25071643e4faeffb882d5a/e4a3f/result.png 295w,\n/static/ee870e31dd25071643e4faeffb882d5a/fcda8/result.png 590w,\n/static/ee870e31dd25071643e4faeffb882d5a/efc66/result.png 885w,\n/static/ee870e31dd25071643e4faeffb882d5a/8b69f/result.png 912w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The information I needed from this page was</p>\n<ul>\n<li>The descriptive title (i.e 2 bedroom flat)</li>\n<li>The price</li>\n<li>The location</li>\n<li>The nearest tube stations</li>\n<li>The date available, which can be empty, ‘Now’ or a string date</li>\n<li>Whether the flat is furnished or not</li>\n<li>The deposit</li>\n</ul>\n<p>Thankfully, this was just a case of identifying appropriate HTML tags and / or CSS selectors and processing the strings appropriately. Here is a snippet of the code used to scrape listings. Each of the <code class=\"language-text\">get</code> methods just select text between appropriate elements in the DOM representation returned by BeautifulSoup.</p>\n<p><code class=\"language-text\">listing.py</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Listing</span><span class=\"token punctuation\">:</span>\n   <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      self<span class=\"token punctuation\">.</span>url <span class=\"token operator\">=</span> url\n\n   <span class=\"token keyword\">def</span> <span class=\"token function\">get_dom</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      html <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n      <span class=\"token keyword\">return</span> BeautifulSoup<span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span> <span class=\"token string\">\"html.parser\"</span><span class=\"token punctuation\">)</span>\n\n   <span class=\"token keyword\">def</span> <span class=\"token function\">scrape_details</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      dom <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_dom<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n      letting_information <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_letting_information<span class=\"token punctuation\">(</span>dom<span class=\"token punctuation\">)</span>\n      self<span class=\"token punctuation\">.</span>date_scraped <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span>today<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strftime<span class=\"token punctuation\">(</span><span class=\"token string\">'%d/%m/%Y'</span><span class=\"token punctuation\">)</span>\n      self<span class=\"token punctuation\">.</span>description <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_description<span class=\"token punctuation\">(</span>dom<span class=\"token punctuation\">)</span>\n      self<span class=\"token punctuation\">.</span>price <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_price<span class=\"token punctuation\">(</span>dom<span class=\"token punctuation\">)</span>\n      self<span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_address<span class=\"token punctuation\">(</span>dom<span class=\"token punctuation\">)</span>\n      self<span class=\"token punctuation\">.</span>nearest_stations <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_nearest_stations<span class=\"token punctuation\">(</span>dom<span class=\"token punctuation\">)</span>\n      self<span class=\"token punctuation\">.</span>date_available <span class=\"token operator\">=</span> letting_information<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"date_available\"</span><span class=\"token punctuation\">)</span>\n      self<span class=\"token punctuation\">.</span>furnished <span class=\"token operator\">=</span> letting_information<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"furnishing\"</span><span class=\"token punctuation\">)</span>\n      self<span class=\"token punctuation\">.</span>deposit <span class=\"token operator\">=</span> letting_information<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"deposit\"</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h3>Filtering Results</h3>\n<hr>\n<p>At this point the script was able to provide a collection of listings which had been posted in the last 24 hours in the configured locations. Now it was time to filter the results based on the star of the show, the ‘Date Available’ property.</p>\n<p>To do so, the string dates were converted to date objects and were filtered using a list comprehension using Pythons standard comparison operators. If the date available is after the current date + N weeks, where N weeks is the number of weeks specified in <code class=\"language-text\">configuration.ini</code>, then the property is included in the final result set.</p>\n<p><code class=\"language-text\">rightmove_scraper.py</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">   <span class=\"token keyword\">def</span> <span class=\"token function\">filter_listings</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> listings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"filters\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"availableAfterNWeeks\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         listings <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_listings_available_after_n_weeks<span class=\"token punctuation\">(</span>\n               <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"filters\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"availableAfterNWeeks\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> listings<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> listings\n\n   <span class=\"token keyword\">def</span> <span class=\"token function\">get_listings_available_after_n_weeks</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> n_weeks<span class=\"token punctuation\">,</span> listings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">not</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>listings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         <span class=\"token keyword\">return</span> listings\n\n      <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>\n         <span class=\"token string-interpolation\"><span class=\"token string\">f'Filtering listings down only those available after </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>n_weeks<span class=\"token punctuation\">}</span></span><span class=\"token string\"> weeks from now'</span></span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">def</span> <span class=\"token function\">convert_date</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         <span class=\"token keyword\">return</span> datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">.</span>strptime<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> <span class=\"token string\">\"%d/%m/%Y\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n      today <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      delta <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>timedelta<span class=\"token punctuation\">(</span>weeks<span class=\"token operator\">=</span>n_weeks<span class=\"token punctuation\">)</span>\n      available_after <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>today <span class=\"token operator\">+</span> delta<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>listing <span class=\"token keyword\">for</span> listing <span class=\"token keyword\">in</span> listings <span class=\"token keyword\">if</span> listing<span class=\"token punctuation\">.</span>has_date_available<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">and</span> convert_daye<span class=\"token punctuation\">(</span>listing<span class=\"token punctuation\">.</span>date_available<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> available_after<span class=\"token punctuation\">]</span></code></pre></div>\n<p>This leaves us with a list of properties uploaded to RightMove in the last 24 hours, in the required locations, available at a time where I would not need to pay two lots of rent. All that’s left is to persist this data and automate the execution.</p>\n<h3>Persistence, Notification and Automation</h3>\n<hr>\n<p>For persistence I decided to store the listings in a Google Sheets worksheet. Although a little unconventional compared to a database this allowed both me and my partner to easily look at the results of the scraping in an interface familiar to both of us.</p>\n<p>Each listing is appended to the sheet if it does not already exist, which is deduced by checking if the listing URL already exists in sheet. To interact with the Google Sheets API I used <a href=\"https://github.com/burnash/gspread\">gspread</a> which provides a clean interface for opening and modifying worksheets.</p>\n<p><code class=\"language-text\">rightmove_scraper.py</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">process_listings</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> listings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   written<span class=\"token punctuation\">,</span> duplicates <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>sheet<span class=\"token punctuation\">.</span>add_listings<span class=\"token punctuation\">(</span>listings<span class=\"token punctuation\">)</span>\n   message <span class=\"token operator\">=</span> dedent<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"\"\"\n            </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>listings<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span></span><span class=\"token string\"> eligible properties were found.\n            </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>written<span class=\"token punctuation\">}</span></span><span class=\"token string\"> new properties were added to the worksheet </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>sheet_name<span class=\"token punctuation\">}</span></span><span class=\"token string\">.\n            </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>duplicates<span class=\"token punctuation\">}</span></span><span class=\"token string\"> properties already existed on the sheet and were ignored.\n            \"\"\"</span></span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n\n   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>has_section<span class=\"token punctuation\">(</span><span class=\"token string\">\"mailer\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">and</span> written<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      mailer_config <span class=\"token operator\">=</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token string\">\"mailer\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      Mailer<span class=\"token punctuation\">(</span>mailer_config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>send_mail<span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">sheet.py</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Sheet</span><span class=\"token punctuation\">:</span>\n   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n   <span class=\"token keyword\">def</span> <span class=\"token function\">add_listings</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> listings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Writing listings to sheet...\"</span><span class=\"token punctuation\">)</span>\n      duplicates <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n      written <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n      <span class=\"token keyword\">for</span> listing <span class=\"token keyword\">in</span> listings<span class=\"token punctuation\">:</span>\n         is_existing_listing <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>does_cell_exist_with_value<span class=\"token punctuation\">(</span>listing<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span>\n         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">not</span> is_existing_listing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n               row <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>build_row<span class=\"token punctuation\">(</span>listing<span class=\"token punctuation\">)</span>\n               self<span class=\"token punctuation\">.</span>worksheet<span class=\"token punctuation\">.</span>insert_row<span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n               written <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n         <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n               duplicates <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>written<span class=\"token punctuation\">,</span> duplicates<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">build_row</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> listing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      row <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n      listing_details <span class=\"token operator\">=</span> <span class=\"token builtin\">vars</span><span class=\"token punctuation\">(</span>listing<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">for</span> _<span class=\"token punctuation\">,</span> attribute <span class=\"token keyword\">in</span> propertyMappings<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         row<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>listing_details<span class=\"token punctuation\">[</span>attribute<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">return</span> row\n   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>When ran, we get a spreadsheet that looks as follows:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3f0da52085c21f82997c9f95e36d6ca7/082c8/sheet.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.594594594594593%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAuElEQVQY012OwY6DMAxE+f9f3EORVgsCqckmsR1MgKkdqh5qaeRYk3n28Duv+Hn8oW77LW0oJCilgJiRc8a2bYgxIphEBM8QzCe0dthcwSz2btB9x5ByQcwVz3KYWu/BZjGYh1NK2O3jPM8YxxFE1Je55+WequK6LpzniUGEQaKIdOCfGoIBE2m/qtbaAd6XZcG6rj3ss/tefpnrA2S+gYkPZDGod1aoBTzE70sdOE3TZ4F7DvkGvgBX4TWr1GZAnQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Sheet\"\n        title=\"Sheet\"\n        src=\"/static/3f0da52085c21f82997c9f95e36d6ca7/fcda8/sheet.png\"\n        srcset=\"/static/3f0da52085c21f82997c9f95e36d6ca7/12f09/sheet.png 148w,\n/static/3f0da52085c21f82997c9f95e36d6ca7/e4a3f/sheet.png 295w,\n/static/3f0da52085c21f82997c9f95e36d6ca7/fcda8/sheet.png 590w,\n/static/3f0da52085c21f82997c9f95e36d6ca7/efc66/sheet.png 885w,\n/static/3f0da52085c21f82997c9f95e36d6ca7/c83ae/sheet.png 1180w,\n/static/3f0da52085c21f82997c9f95e36d6ca7/082c8/sheet.png 2734w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As a final touch, I setup email notifications using <a href=\"https://docs.python.org/3/library/smtplib.html\">smtplib</a> to nofitfy me whenever new properties were added to the sheet.</p>\n<p>The final step was to automate the execution. I did consider using this as an opportunity to learn AWS Lambda but ended up running the script hourly via a CRON job on a Raspberry Pi.</p>\n<h3>Wrapping Up</h3>\n<hr>\n<p>The script has been nicely ticking away for a few weeks now, saving me hours of manually finding and tracking which properties were available in the required timeframe.</p>\n<p>It’s not pretty, it’s not particularly clever and there are a number of improvements that could be made, however, it solved my problem and has saved me time which was the aim of the game.</p>\n<p>If you want to have a play, the source can be found <a href=\"https://github.com/JordWyatt/rightmove-by-notice-period\">here</a>.</p>\n<p>Thanks for reading :)</p>","frontmatter":{"title":"Using Python to work around a 2 month notice period","date":"June 27, 2020","description":"Using webscraping to overcome RightMove's shortcomings."}}},"pageContext":{"slug":"/rightmove-scraper/","previous":null,"next":null}}}